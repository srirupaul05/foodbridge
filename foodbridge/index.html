<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FoodBridge â€” Every Bite Counts</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>

  <!-- CSS Files -->
  <link rel="stylesheet" href="css/style.css"/>
  <link rel="stylesheet" href="css/navbar.css"/>
  <link rel="stylesheet" href="css/home.css"/>
  <link rel="stylesheet" href="css/auth.css"/>
  <link rel="stylesheet" href="css/donor.css"/>
  <link rel="stylesheet" href="css/recipient.css"/>
  <link rel="stylesheet" href="css/tracker.css"/>
  <link rel="stylesheet" href="css/impact.css"/>
  <link rel="stylesheet" href="css/chat.css"/>
  <link rel="stylesheet" href="css/map.css"/>
  <link rel="stylesheet" href="css/admin.css"/>

<!-- Leaflet Map CSS â€” free, no API key -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
</head>
<body>

  <!-- Email Verification Banner -->
  <div id="verify-banner" class="verify-banner hidden">
    <p>
      âš ï¸ Your email is not verified!
      Please check your inbox and click the verification link.
      <button onclick="resendBannerVerification()"
        class="btn-resend-verify">
        ğŸ“§ Resend Email
      </button>
      <button onclick="checkVerificationStatus()"
        class="btn-check-verify">
        âœ… I verified it!
      </button>
    </p>
  </div>
  
  <!-- NAVBAR -->
  <nav id="navbar">
    <div class="nav-logo">ğŸŒ± FoodBridge</div>
    <div class="nav-links" id="navLinks">
      <a href="#" onclick="showPage('home')">Home</a>
      <a href="#" onclick="showPage('recipient')">Find Food</a>
      <a href="#" onclick="showPage('donor')">Donate Food</a>
      <a href="#" onclick="showPage('tracker')">Expiry Tracker</a>
      <a href="#" onclick="showPage('impact')">Impact</a>
      <a href="#" onclick="showPage('admin')" id="nav-admin" class="hidden">ğŸ‘‘ Admin</a>
    </div>
    <div class="nav-auth" id="navAuth">
      <button onclick="showPage('auth')" class="btn-login">Login</button>
      <button onclick="showPage('auth')" class="btn-signup">Sign Up</button>
    </div>
    <div class="nav-user hidden" id="navUser">
      <span id="userNameDisplay"></span>
      <button onclick="logoutUser()" class="btn-logout">Logout</button>
    </div>
  </nav>

  <!-- ===== HOME PAGE ===== -->
  <div id="page-home" class="page active">

    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-text">
        <h1>Every Bite <span>Counts</span></h1>
        <p>Connecting surplus food with people who need it most. Reduce waste. Feed communities. Build impact.</p>
        <div class="hero-btns">
          <button onclick="showPage('donor')" class="btn-primary">Donate Food</button>
          <button onclick="showPage('recipient')" class="btn-secondary">Find Food</button>
        </div>
      </div>
      <div class="hero-image">ğŸŒ</div>
    </section>

    <!-- Stats Bar -->
    <section class="stats-bar">
      <div class="stat">
        <h2 id="stat-meals">0</h2>
        <p>Meals Provided</p>
      </div>
      <div class="stat">
        <h2 id="stat-kg">0</h2>
        <p>KG Food Rescued</p>
      </div>
      <div class="stat">
        <h2 id="stat-co2">0</h2>
        <p>KG COâ‚‚ Avoided</p>
      </div>
      <div class="stat">
        <h2 id="stat-donors">0</h2>
        <p>Active Donors</p>
      </div>
    </section>

    <!-- How It Works -->
    <section class="how-it-works">
      <h2>How FoodBridge Works</h2>
      <div class="steps">
        <div class="step">
          <div class="step-icon">ğŸ“¦</div>
          <h3>Donor Posts Food</h3>
          <p>Restaurants, stores, or individuals post surplus food with pickup details.</p>
        </div>
        <div class="step">
          <div class="step-icon">ğŸ””</div>
          <h3>Recipients Get Notified</h3>
          <p>Nearby food banks and individuals in need see available food instantly.</p>
        </div>
        <div class="step">
          <div class="step-icon">ğŸ¤</div>
          <h3>Food Gets Claimed</h3>
          <p>Recipients claim food and arrange pickup before it goes to waste.</p>
        </div>
        <div class="step">
          <div class="step-icon">ğŸŒ</div>
          <h3>Impact Is Tracked</h3>
          <p>Every donation is tracked and converted into real impact numbers.</p>
        </div>
      </div>
    </section>

  </div>

  <!-- ===== AUTH PAGE ===== -->
  <div id="page-auth" class="page">
    <div class="auth-container">
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchTab('login')">Login</button>
        <button class="auth-tab" onclick="switchTab('signup')">Sign Up</button>
      </div>

      <!-- Login Form -->
      <div id="login-form" class="auth-form">
        <h2>Welcome Back ğŸ‘‹</h2>
        <input type="email" id="login-email" placeholder="Email address"/>
        <input type="password" id="login-password" placeholder="Password"/>
        <button onclick="loginUser()" class="btn-primary">Login</button>
        <p id="login-error" class="error-msg"></p>
      </div>

      <!-- Signup Form -->
      <div id="signup-form" class="auth-form hidden">
        <h2>Join FoodBridge ğŸŒ±</h2>
        <input type="text" id="signup-name" placeholder="Full Name"/>
        <input type="email" id="signup-email" placeholder="Email address"/>
        <input type="password" id="signup-password" placeholder="Password (min 6 chars)"/>
        <select id="signup-role">
          <option value="">Select your role...</option>
          <option value="donor">ğŸ± Donor (Restaurant / Individual)</option>
          <option value="recipient">ğŸ™ Recipient (Food Bank / Individual in need)</option>
          <option value="volunteer">ğŸš— Volunteer (Pickup & Delivery)</option>
        </select>
        <button onclick="signupUser()" class="btn-primary">Create Account</button>
        <p id="signup-error" class="error-msg"></p>
      </div>
    </div>
  </div>

  <!-- ===== DONOR PAGE ===== -->
  <div id="page-donor" class="page">
    <div class="page-container">
      <h1 class="page-title">ğŸ± Donate Food</h1>
      <p class="page-subtitle">Post your surplus food and help someone today</p>

      <div class="donor-layout">
        <!-- Post Food Form -->
        <div class="card" id="donor-form-card">
          <h3>Post New Food Listing</h3>
          <input type="text" id="food-name" placeholder="Food name (e.g. Rice & Dal)"/>
          <select id="food-category">
            <option value="">Select category...</option>
            <option value="veg">ğŸ¥¦ Vegetarian</option>
            <option value="nonveg">ğŸ— Non-Vegetarian</option>
            <option value="bakery">ğŸ Bakery</option>
            <option value="dairy">ğŸ¥› Dairy</option>
            <option value="fruits">ğŸ Fruits & Vegetables</option>
            <option value="cooked">ğŸ² Cooked Meal</option>
            <option value="packaged">ğŸ“¦ Packaged Food</option>
          </select>
          <input type="number" id="food-quantity" placeholder="Quantity (in kg or servings)"/>
          <input type="text" id="food-unit" placeholder="Unit (kg / servings / packets)"/>

          <label>ğŸ“… Expiry Date & Time (when food goes bad)</label>
          <input type="datetime-local" id="food-expiry"/>

          <label>ğŸ• Pickup Window Start (earliest pickup time)</label>
          <input type="datetime-local" id="pickup-start"/>

          <label>ğŸ•‘ Pickup Window End (latest pickup time)</label>
          <input type="datetime-local" id="pickup-end"/>

          <input type="text" id="food-location" placeholder="Pickup location / address"/>
          <textarea id="food-notes" placeholder="Any additional notes..."></textarea>

<!-- Camera Section -->
<div class="camera-section" id="camera-section">
  <h4>ğŸ“¸ Food Photo (Required)</h4>
  <p class="camera-hint">Live photo only â€” no uploads from gallery allowed</p>

  <!-- Camera Preview -->
  <div class="camera-container" id="camera-container">
    <video id="camera-feed" autoplay playsinline></video>
    <canvas id="camera-canvas" style="display:none"></canvas>
  </div>

  <!-- Camera Controls -->
  <div class="camera-controls">
    <button type="button" onclick="startCamera()" 
      class="btn-camera" id="btn-start-camera">
      ğŸ“· Open Camera
    </button>
    <button type="button" onclick="capturePhoto()" 
      class="btn-capture hidden" id="btn-capture">
      ğŸ”´ Take Photo
    </button>
    <button type="button" onclick="retakePhoto()" 
      class="btn-retake hidden" id="btn-retake">
      ğŸ”„ Retake
    </button>
  </div>

  <!-- Photo Preview -->
  <div id="photo-preview-container" class="hidden">
    <img id="photo-preview" src="" alt="Food photo preview"/>
    <p class="photo-ok">âœ… Photo captured!</p>
  </div>
</div>

<button onclick="postFood()" class="btn-primary">
  Post Food Listing âœ…
</button>
<p id="donor-msg" class="success-msg"></p>
        </div>

        <!-- My Donations -->
        <div class="card">
          <h3>My Donations</h3>
          <div id="my-donations-list">
            <p class="empty-msg">No donations yet. Post your first one! ğŸ‘†</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== RECIPIENT PAGE ===== -->
  <div id="page-recipient" class="page">
    <div class="page-container">
      <h1 class="page-title">ğŸ½ï¸ Find Food Near You</h1>
      <p class="page-subtitle">Browse available food listings and claim what you need</p>

<!-- Search Bar -->
      <div class="search-bar">
        <input
          type="text"
          id="search-input"
          placeholder="ğŸ” Search food or location..."
          oninput="filterListings()"
        />
      </div>

      <!-- Filters & View Toggle -->
      <div class="filters">
        <select id="filter-category" onchange="filterListings()">
          <option value="">All Categories</option>
          <option value="veg">ğŸ¥¦ Vegetarian</option>
          <option value="nonveg">ğŸ— Non-Vegetarian</option>
          <option value="bakery">ğŸ Bakery</option>
          <option value="dairy">ğŸ¥› Dairy</option>
          <option value="fruits">ğŸ Fruits & Vegetables</option>
          <option value="cooked">ğŸ² Cooked Meal</option>
          <option value="packaged">ğŸ“¦ Packaged Food</option>
        </select>

        <select id="filter-expiry" onchange="filterListings()">
          <option value="">All Expiry</option>
          <option value="today">âš¡ Today only</option>
          <option value="urgent">ğŸ”´ Urgent (1-2 days)</option>
          <option value="week">âœ… This week</option>
        </select>

        <button onclick="resetFilters()" class="btn-secondary">
          âœ• Reset
        </button>
        <button onclick="loadListings()" class="btn-secondary">
          ğŸ”„ Refresh
        </button>

        <!-- View Toggle -->
        <div class="view-toggle">
          <button
            class="btn-view active"
            id="btn-grid-view"
            onclick="switchView('grid')">
            â–¦ Grid
          </button>
          <button
            class="btn-view"
            id="btn-map-view"
            onclick="switchView('map')">
            ğŸ“ Map
          </button>
        </div>
      </div>

      <!-- Food Listings Grid -->
      <div id="food-listings-grid" class="listings-grid">
        <p class="empty-msg">Loading available food...</p>
      </div>

      <!-- Map View -->
      <div id="food-listings-map" class="map-container hidden">
        <div id="leaflet-map"></div>
        <div id="map-popup" class="map-popup hidden"></div>
      </div>
    </div>
  </div>

  <!-- ===== TRACKER PAGE ===== -->
  <div id="page-tracker" class="page">
    <div class="page-container">
      <h1 class="page-title">â° Expiry Tracker</h1>
      <p class="page-subtitle">Track your groceries and get notified before they expire</p>

      <div class="tracker-layout">
        <!-- Add Item -->
        <div class="card">
          <h3>Add Grocery Item</h3>
          <input type="text" id="item-name" placeholder="Item name (e.g. Milk)"/>
          <input type="number" id="item-quantity" placeholder="Quantity"/>
          <input type="text" id="item-unit" placeholder="Unit (litres / kg / packets)"/>
          <input type="date" id="item-expiry"/>
          <button onclick="addTrackerItem()" class="btn-primary">Add Item â•</button>
          <p id="tracker-msg" class="success-msg"></p>
        </div>

        <!-- Tracked Items -->
        <div class="card">
          <h3>Your Grocery List</h3>
          <div id="tracker-items-list">
            <p class="empty-msg">No items added yet.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== ADMIN PAGE ===== -->
<div id="page-admin" class="page hidden">
  <div class="page-container">

    <div class="admin-header">
      <h1>ğŸ‘‘ Admin Dashboard</h1>
      <p>Welcome back, Srirup! Here's everything happening on FoodBridge.</p>
    </div>

    <!-- Overview Cards -->
    <div class="admin-overview">
      <div class="admin-card green">
        <h2 id="admin-total-users">0</h2>
        <p>Total Users</p>
        <span>ğŸ‘¥</span>
      </div>
      <div class="admin-card blue">
        <h2 id="admin-total-donations">0</h2>
        <p>Total Donations</p>
        <span>ğŸ±</span>
      </div>
      <div class="admin-card orange">
        <h2 id="admin-total-claims">0</h2>
        <p>Total Claims</p>
        <span>ğŸ¤</span>
      </div>
      <div class="admin-card teal">
        <h2 id="admin-total-kg">0</h2>
        <p>KG Rescued</p>
        <span>â™»ï¸</span>
      </div>
    </div>

    <!-- Tabs -->
    <div class="admin-tabs">
      <button
        class="admin-tab active"
        onclick="switchAdminTab('users')">
        ğŸ‘¥ Users
      </button>
      <button
        class="admin-tab"
        onclick="switchAdminTab('donations')">
        ğŸ± Donations
      </button>
      <button
        class="admin-tab"
        onclick="switchAdminTab('claims')">
        ğŸ¤ Claims
      </button>
    </div>

    <!-- Users Table -->
    <div id="admin-tab-users" class="admin-table-container">
      <div class="admin-table-header">
        <h3>ğŸ‘¥ All Users</h3>
     <input
        type="text"
        id="admin-search-users"
        placeholder="ğŸ” Search users..."
        autocomplete="off"
        oninput="searchAdminTable('users')"
      />

      </div>
      <div class="table-wrapper">
        <table id="users-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Joined</th>
              <th>Donations</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="users-tbody">
            <tr><td colspan="6" class="table-loading">
              â³ Loading users...
            </td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Donations Table -->
    <div id="admin-tab-donations"
         class="admin-table-container hidden">
      <div class="admin-table-header">
        <h3>ğŸ± All Donations</h3>
      <input
        type="text"
        id="admin-search-donations"
        placeholder="ğŸ” Search donations..."
        autocomplete="off"
        oninput="searchAdminTable('donations')"
      />

      </div>
      <div class="table-wrapper">
        <table id="donations-table">
          <thead>
            <tr>
              <th>Food</th>
              <th>Donor</th>
              <th>Email</th>
              <th>Qty</th>
              <th>Location</th>
              <th>Status</th>
              <th>Posted</th>
              <th>Expiry</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="donations-tbody">
            <tr><td colspan="9" class="table-loading">
              â³ Loading donations...
            </td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Claims Table -->
    <div id="admin-tab-claims"
         class="admin-table-container hidden">
      <div class="admin-table-header">
        <h3>ğŸ¤ All Claims</h3>
        <input
          type="text"
          id="admin-search-claims"
          placeholder="ğŸ” Search claims..."
          autocomplete="off"
          oninput="searchAdminTable('claims')"
        />

      </div>
      <div class="table-wrapper">
        <table id="claims-table">
          <thead>
            <tr>
              <th>Food</th>
              <th>Donor</th>
              <th>Donor Email</th>
              <th>Recipient</th>
              <th>Recipient Email</th>
              <th>Claimed At</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="claims-tbody">
            <tr><td colspan="7" class="table-loading">
              â³ Loading claims...
            </td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

  <!-- ===== IMPACT PAGE ===== -->
  <div id="page-impact" class="page">
    <div class="page-container">
      <h1 class="page-title">ğŸŒ Your Impact</h1>
      <p class="page-subtitle">See the difference you're making in the world</p>

      <!-- Personal Impact -->
      <div class="impact-grid">
        <div class="impact-card green">
          <div class="impact-icon">ğŸ½ï¸</div>
          <h2 id="my-meals">0</h2>
          <p>Meals Provided</p>
        </div>
        <div class="impact-card blue">
          <div class="impact-icon">â™»ï¸</div>
          <h2 id="my-kg">0</h2>
          <p>KG Food Rescued</p>
        </div>
        <div class="impact-card orange">
          <div class="impact-icon">ğŸŒ¿</div>
          <h2 id="my-co2">0</h2>
          <p>KG COâ‚‚ Avoided</p>
        </div>
        <div class="impact-card teal">
          <div class="impact-icon">ğŸ’§</div>
          <h2 id="my-water">0</h2>
          <p>Litres Water Saved</p>
        </div>
      </div>

      <!-- Badges -->
      <div class="card badges-card">
        <h3>ğŸ† Your Badges</h3>
        <div id="badges-container" class="badges-grid"></div>
      </div>

      <!-- Leaderboard -->
      <div class="card">
        <h3>ğŸ… Community Leaderboard</h3>
        <div id="leaderboard-list" class="leaderboard"></div>
      </div>

    </div>
  </div>

 <!-- JS Files â€” order matters! -->
  <script type="module" src="js/firebase-config.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script type="module" src="js/app.js"></script>
  <script type="module" src="js/donor.js"></script>
  <script type="module" src="js/recipient.js"></script>
  <script type="module" src="js/tracker.js"></script>
  <script type="module" src="js/impact.js"></script>
  <script type="module" src="js/chat.js"></script>
  <script type="module" src="js/map.js"></script>
  <script type="module" src="js/admin.js"></script>

<!-- Leaflet Map JS â€” free, no API key -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- ===== CHAT MODAL ===== -->
  <div id="chat-modal" class="chat-modal hidden">
    <div class="chat-window">

      <!-- Chat Header -->
      <div class="chat-header">
        <div class="chat-header-info">
          <h3 id="chat-title">ğŸ’¬ Chat</h3>
          <p id="chat-subtitle">Real-time messaging</p>
        </div>
        <button onclick="closeChat()" class="btn-close-chat">âœ•</button>
      </div>

      <!-- Messages Area -->
      <div class="chat-messages" id="chat-messages">
        <p class="chat-loading">â³ Loading messages...</p>
      </div>

      <!-- Input Area -->
      <div class="chat-input-area">
        <input
          type="text"
          id="chat-input"
          placeholder="Type a message..."
          onkeypress="handleChatKeyPress(event)"
        />
        <button onclick="sendMessage()" class="btn-send">
          Send ğŸ“¨
        </button>
      </div>

    </div>
  </div>

</body>

</body>
</html>